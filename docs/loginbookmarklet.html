<html>
<head>
  <title>アイプリ 自動ログイン生成</title>
  <script language="javascript" type="text/javascript">
    function generate(){
      const pid = document.getElementById("card_id").value;
      const pname = document.getElementById("name").value;
      const pbdm = document.getElementById("birthdayM").value;
      const pbdd = document.getElementById("birthdayD").value;
      const textData = `javascript:(function () {
  const data = { 'card_id': '${pid}', 'name': '${pname}', 'birthdayM': '${pbdm}', 'birthdayD': '${pbdd}' }
  const form = document.createElement('form');
  form.method = 'POST';
  form.action = 'https://aipri.jp/mypage/login/';
  for (let d in data) {
    let input = document.createElement('input');
    input.name = \`val[\${d}]\`;
    input.value = data[d];
    form.appendChild(input);
  }
  document.body.appendChild(form);
  form.submit();
})();
`;
      const result = encodeURI(textData);
      document.getElementById('result').textContent = result;
    }

    function copyResult(){
      navigator.clipboard.writeText(document.getElementById('result').textContent);
    }
  </script>
</head>

<body>
  <h2>アイプリ マイページログイン用ブックマークレット生成</h2>
  <h4>つかいかた</h4>
  <ol>
    <li>下のフォームに情報を入力する</li>
    <li>「ブックマークレット生成」ボタンを押す</li>
    <li>生成されたコードをコピーする</li>
    <li>このページをブックマーク(任意のページでよい)する</li>
    <li>作ったブックマークのアドレスをコピーしたコードに編集する</li>
    <li>作ったブックマークを叩けばログインできる</li>
  </ol>
  <form>
    <table>
      <tr>
        <td style="text-align: right;">
          <label>ID:</label>
        </td>
        <td>
          <input id="card_id" type="text" placeholder="ABCDEFGH-ABCDEFG">
        </td>
      </tr>
      <tr>
        <td style="text-align: right;">
          <label>名前:</label>
        </td>
        <td>
          <input id="name" type="text" placeholder="ひまり">
        </td>
      </tr>
      <tr>
        <td style="text-align: right;">
          <label>誕生日:</label>
        </td>
        <td>
          <input id="birthdayM" type="text" placeholder="8">月 <input id="birthdayD" type="text" placeholder="18">日
        </td>
      </tr>
    </table>
    <input type="button" value="ブックマークレット生成" onclick="generate()">
  </form>
  <br>
  <label>結果</label> <input type="button" value="結果をコピー" onclick="copyResult()"><br>
  <textarea readonly id="result" cols="50" rows="20"></textarea>
</body>
</html>
